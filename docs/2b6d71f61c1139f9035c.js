let tocHelpShown=!1;function createConfirmDialog(){document.body.insertAdjacentHTML("beforeend",'\n        <div id="confirmDialog" class="confirm-dialog-overlay" style="display: none;">\n            <div class="confirm-dialog">\n                <div class="confirm-dialog-header">\n                    <span class="confirm-dialog-icon">‚ö†Ô∏è</span>\n                    <h3>Confirmation requise</h3>\n                </div>\n                <div class="confirm-dialog-body">\n                    <p id="confirmMessage"></p>\n                </div>\n                <div class="confirm-dialog-footer">\n                    <button id="confirmCancel" class="btn-dialog btn-cancel">Annuler</button>\n                    <button id="confirmOK" class="btn-dialog btn-confirm">Confirmer</button>\n                </div>\n            </div>\n        </div>\n    ')}function createHelpDialog(){document.body.insertAdjacentHTML("beforeend",'\n        <div id="helpDialog" class="help-dialog-overlay" style="display: none;">\n            <div class="help-dialog">\n                <div class="help-dialog-header">\n                    <span class="help-dialog-icon">üí°</span>\n                    <h3>Aide : Ins√©rer une table des mati√®res</h3>\n                </div>\n                <div class="help-dialog-body">\n                    <p><strong>C\'est √† vous de jouer !</strong></p>\n                    <p>Pour apprendre √† utiliser Word efficacement, essayez d\'ins√©rer la table des mati√®res par vous-m√™me.</p>\n                    \n                    <div class="hint-box">\n                        <h4>üîç Indice :</h4>\n                        <p>Regardez dans l\'onglet <strong>"R√©f√©rences"</strong> du ruban Word.</p>\n                        <p>Vous y trouverez un bouton <strong>"Table des mati√®res"</strong>.</p>\n                    </div>\n                    \n                    <div class="steps-box">\n                        <h4>üìù √âtapes sugg√©r√©es :</h4>\n                        <ol>\n                            <li>Positionnez votre curseur sous le titre "Table des mati√®res"</li>\n                            <li>Allez dans l\'onglet <strong>R√©f√©rences</strong></li>\n                            <li>Cliquez sur <strong>Table des mati√®res</strong></li>\n                            <li>Choisissez un mod√®le qui affiche les num√©ros de page</li>\n                        </ol>\n                    </div>\n                    \n                    <p class="help-note">üí° <em>Astuce : Choisissez un mod√®le automatique pour avoir des liens cliquables !</em></p>\n                </div>\n                <div class="help-dialog-footer">\n                    <button id="helpOK" class="btn-dialog btn-help-ok">J\'ai compris !</button>\n                </div>\n            </div>\n        </div>\n    '),document.head.insertAdjacentHTML("beforeend","\n        <style>\n        /* Styles du dialogue de confirmation */\n        .confirm-dialog-overlay, .help-dialog-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.5);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n            animation: fadeIn 0.2s ease;\n        }\n        \n        .confirm-dialog, .help-dialog {\n            background: white;\n            border-radius: 12px;\n            padding: 0;\n            width: 90%;\n            max-width: 450px;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n            animation: slideUp 0.3s ease;\n            overflow: hidden;\n        }\n        \n        .confirm-dialog-header {\n            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n            color: white;\n            padding: 20px;\n            text-align: center;\n        }\n        \n        .help-dialog-header {\n            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);\n            color: white;\n            padding: 10px;\n            text-align: center;\n        }\n        \n        .confirm-dialog-icon, .help-dialog-icon {\n            font-size: 48px;\n            display: block;\n            margin-bottom: 10px;\n        }\n        \n        .confirm-dialog-header h3, .help-dialog-header h3 {\n            margin: 0;\n            font-size: 20px;\n        }\n        \n        .confirm-dialog-body, .help-dialog-body {\n            padding: 15px;\n        }\n        \n        .confirm-dialog-body p, .help-dialog-body p {\n            margin: 10px 0;\n            line-height: 1.6;\n            color: #333;\n            font-size: 14px;\n        }\n        \n        .hint-box {\n            background: #e3f2fd;\n            border-left: 4px solid #2196F3;\n            padding: 10px;\n            margin: 20px 0;\n            border-radius: 8px;\n        }\n        \n        .hint-box h4 {\n            margin: 0 0 10px 0;\n            color: #1976D2;\n            font-size: 16px;\n        }\n        \n        .steps-box {\n            background: #f3e5f5;\n            border-left: 4px solid #9c27b0;\n            padding: 5px;\n            margin: 20px 0;\n            border-radius: 8px;\n        }\n        \n        .steps-box h4 {\n            margin: 0 0 10px 0;\n            color: #7b1fa2;\n            font-size: 16px;\n        }\n        \n        .steps-box ol {\n            margin: 10px 0 0 20px;\n            padding: 0;\n            color: #555;\n        }\n        \n        .steps-box li {\n            margin: 8px 0;\n            line-height: 1.5;\n        }\n        \n        .help-note {\n            background: #fff3e0;\n            padding: 10px;\n            border-radius: 6px;\n            margin-top: 15px;\n        }\n        \n        .confirm-dialog-footer, .help-dialog-footer {\n            display: flex;\n            gap: 10px;\n            padding: 15px 20px;\n            background: #f8f9fa;\n            justify-content: flex-end;\n        }\n        \n        .btn-dialog {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        \n        .btn-cancel {\n            background: #e9ecef;\n            color: #495057;\n        }\n        \n        .btn-cancel:hover {\n            background: #dee2e6;\n        }\n        \n        .btn-confirm {\n            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n            color: white;\n        }\n        \n        .btn-help-ok {\n            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);\n            color: white;\n            min-width: 120px;\n        }\n        \n        .btn-confirm:hover, .btn-help-ok:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);\n        }\n        \n        @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n        }\n        \n        @keyframes slideUp {\n            from { \n                transform: translateY(20px);\n                opacity: 0;\n            }\n            to { \n                transform: translateY(0);\n                opacity: 1;\n            }\n        }\n        </style>\n    ")}function showConfirmDialog(e){return new Promise(n=>{const t=document.getElementById("confirmDialog"),o=document.getElementById("confirmMessage"),a=document.getElementById("confirmCancel"),s=document.getElementById("confirmOK");function i(){t.style.display="none",a.removeEventListener("click",i),s.removeEventListener("click",r),n(!1)}function r(){t.style.display="none",a.removeEventListener("click",i),s.removeEventListener("click",r),n(!0)}o.innerHTML=e,t.style.display="flex",a.addEventListener("click",i),s.addEventListener("click",r)})}function showTableOfContentsHelp(){const e=document.getElementById("helpDialog"),n=document.getElementById("helpOK");e.style.display="flex",n.addEventListener("click",function t(){e.style.display="none",n.removeEventListener("click",t),tocHelpShown=!0;const o=document.getElementById("tocBtn").querySelector("span:nth-child(2)");o&&(o.textContent="Afficher l'aide √† nouveau"),showStatus("üí™ √Ä vous de jouer ! Utilisez l'onglet R√©f√©rences pour ins√©rer la table des mati√®res.","info")})}async function generateDocument(){const e=document.getElementById("generateLoader"),n=document.getElementById("generateBtn");try{e.style.display="inline-block",n.disabled=!0,await Word.run(async t=>{const o=t.document.body;if(o.load("text"),await t.sync(),o.text.trim().length>0){if(!await showConfirmDialog("<strong>Attention : Le document actuel n'est pas vide.</strong><br><br>Voulez-vous effacer tout le contenu existant et g√©n√©rer un nouveau document ?<br><br><em>Cette action est irr√©versible.</em>"))return showStatus("G√©n√©ration annul√©e. Le document existant a √©t√© conserv√©.","info"),e.style.display="none",void(n.disabled=!1);o.clear()}await generateDocumentContent(o),await t.sync(),document.getElementById("documentDetails").style.display="block",showStatus("‚úÖ Document g√©n√©r√© avec succ√®s ! Maintenant, utilisez l'onglet R√©f√©rences pour ins√©rer la table des mati√®res manuellement.","success")})}catch(e){console.error("Erreur:",e),showStatus("‚ùå Erreur lors de la g√©n√©ration : "+e.message,"error")}finally{e.style.display="none",n.disabled=!1}}async function generateDocumentContent(e){const n=e.insertParagraph(documentContent.coverPage.title,Word.InsertLocation.start);n.styleBuiltIn=Word.Style.title,n.alignment=Word.Alignment.centered,n.spaceAfter=200;const t=e.insertParagraph(documentContent.coverPage.subtitle,Word.InsertLocation.end);t.alignment=Word.Alignment.centered,t.font.size=18,t.font.color="#4a5568",t.spaceAfter=100;const o=e.insertParagraph(documentContent.coverPage.date,Word.InsertLocation.end);o.alignment=Word.Alignment.centered,o.font.size=14,o.font.color="#718096",e.insertBreak(Word.BreakType.page,Word.InsertLocation.end);const a=e.insertParagraph("[Ins√©rez la table des mati√®res ici!]",Word.InsertLocation.end);a.font.italic=!0,a.font.color="#999999",a.alignment=Word.Alignment.left,e.insertBreak(Word.BreakType.page,Word.InsertLocation.end),documentContent.chapters.forEach((n,t)=>{const o=e.insertParagraph(n.title,Word.InsertLocation.end);if(o.styleBuiltIn=Word.Style.heading1,o.spaceAfter=15,n.introduction){const t=e.insertParagraph(n.introduction,Word.InsertLocation.end);t.styleBuiltIn=Word.Style.normal,t.spaceAfter=20}n.sections.forEach(n=>{const t=e.insertParagraph(n.title,Word.InsertLocation.end);t.styleBuiltIn=Word.Style.heading2,t.spaceAfter=10;const o=e.insertParagraph(n.content,Word.InsertLocation.end);o.styleBuiltIn=Word.Style.normal,o.spaceAfter=15,n.subsections&&n.subsections.forEach(n=>{const t=e.insertParagraph(n.title,Word.InsertLocation.end);t.styleBuiltIn=Word.Style.heading3,t.spaceAfter=8;const o=e.insertParagraph(n.content,Word.InsertLocation.end);o.styleBuiltIn=Word.Style.normal,o.spaceAfter=15})}),t<documentContent.chapters.length-1&&e.insertBreak(Word.BreakType.page,Word.InsertLocation.end)}),e.insertBreak(Word.BreakType.page,Word.InsertLocation.end);const s=e.insertParagraph(documentContent.conclusion.title,Word.InsertLocation.end);s.styleBuiltIn=Word.Style.heading1,s.spaceAfter=15,e.insertParagraph(documentContent.conclusion.content,Word.InsertLocation.end).styleBuiltIn=Word.Style.normal,e.insertBreak(Word.BreakType.page,Word.InsertLocation.end);const i=e.insertParagraph(documentContent.source,Word.InsertLocation.end);i.font.italic=!0,i.font.size=10,i.font.color="#666666",i.alignment=Word.Alignment.centered}async function validateDocument(){const e=document.getElementById("validateLoader"),n=document.getElementById("validateBtn");try{e.style.display="inline-block",n.disabled=!0,await Word.run(async e=>{e.document.body;let n=[];const t=e.document.body.search("Table des mati√®res",{matchCase:!1});t.load("items"),await e.sync();const o=t.items.length>0;n.push({check:"Titre 'Table des mati√®res' pr√©sent",passed:o,message:o?"Le titre 'Table des mati√®res' est pr√©sent":"Le titre 'Table des mati√®res' n'a pas √©t√© trouv√©"});const a=e.document.body.search("[Ins√©rez la table des mati√®res ici",{matchCase:!1});a.load("items"),await e.sync();const s=0===a.items.length;n.push({check:"Table des mati√®res ins√©r√©e",passed:s,message:s?"Une table des mati√®res a √©t√© ins√©r√©e":"Le placeholder est toujours pr√©sent - Utilisez l'onglet R√©f√©rences"});let i=!1;if(s&&o){e.document.body.search(".",{matchCase:!1,matchWildcards:!0}).load("items");const n=["1","2","3","4","5","6"];let t=!1;for(const o of n){const n=e.document.body.search(o,{matchCase:!1});if(n.load("items"),await e.sync(),n.items.length>0){t=!0;break}}i=t}n.push({check:"Num√©ros de page affich√©s",passed:i,message:i?"La table des mati√®res affiche des num√©ros de page":"Les num√©ros de page ne sont pas visibles - Choisissez un mod√®le avec num√©ros"});let r=!1;s&&o&&(r=!0),n.push({check:"Table au bon emplacement",passed:r,message:r?"La table est positionn√©e sous le titre 'Table des mati√®res'":"La table n'est pas au bon emplacement"});let l=!1;if(s){const n=["Introduction","Applications","D√©fis"];let t=0;for(const o of n){const n=e.document.body.search(o,{matchCase:!1});n.load("items"),await e.sync(),n.items.length>1&&t++}l=t>=2}n.push({check:"Liens cliquables (mod√®le automatique)",passed:l,message:l?"La table semble utiliser un mod√®le automatique avec liens":"Utilisez un mod√®le automatique pour avoir des liens cliquables"}),displayValidationResults(n);const d=n.filter(e=>e.passed).length,c=n.length,m=Math.round(d/c*100);100===m?showStatus(`‚úÖ Excellent ! Tous les ${c} crit√®res sont valid√©s. La table des mati√®res est parfaitement configur√©e.`,"success"):m>=60?showStatus(`‚ö†Ô∏è Presque parfait : ${d}/${c} crit√®res valid√©s (${m}%). V√©rifiez les points manquants.`,"warning"):showStatus(`‚ùå Incomplet : ${d}/${c} crit√®res valid√©s (${m}%). Utilisez l'onglet R√©f√©rences pour ins√©rer une table des mati√®res automatique.`,"error")})}catch(e){console.error("Erreur:",e),showStatus("‚ùå Erreur lors de la validation : "+e.message,"error")}finally{e.style.display="none",n.disabled=!1}}function displayValidationResults(e){const n=document.getElementById("validationResults"),t=document.getElementById("validationContent");t.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.className="validation-item";const o=document.createElement("span");o.className=e.passed?"check-icon":"cross-icon",o.textContent=e.passed?"‚úì":"‚úó";const a=document.createElement("span");a.innerHTML=`<strong>${e.check}</strong><br>\n                         <small style="color: #666; font-size: 11px;">${e.message}</small>`,n.appendChild(o),n.appendChild(a),t.appendChild(n)}),n.style.display="block",n.style.animation="slideIn 0.3s ease"}function showStatus(e,n){const t=document.getElementById("statusMessage");t.textContent=e,t.className="status-message status-"+n,t.style.display="block",t.style.animation="slideIn 0.3s ease","success"!==n&&"info"!==n||setTimeout(()=>{t.style.animation="fadeOut 0.3s ease",setTimeout(()=>{t.style.display="none"},300)},7e3)}Office.onReady(e=>{e.host===Office.HostType.Word&&(document.getElementById("generateBtn").onclick=generateDocument,document.getElementById("tocBtn").onclick=showTableOfContentsHelp,document.getElementById("validateBtn").onclick=validateDocument,createConfirmDialog(),createHelpDialog(),showStatus("‚ú® Compl√©ment charg√© avec succ√®s ! Pr√™t √† g√©n√©rer votre document.","info"))});const style=document.createElement("style");style.textContent="\n    @keyframes fadeOut {\n        from { opacity: 1; }\n        to { opacity: 0; }\n    }\n",document.head.appendChild(style),window.onerror=function(e,n,t,o,a){return console.error("Erreur globale:",a),showStatus("‚ùå Une erreur inattendue s'est produite. Veuillez r√©essayer.","error"),!1};